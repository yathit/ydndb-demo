<!DOCTYPE html>
<html>
<head lang="en">
  <meta charset="UTF-8">
  <title>Crypto module example</title>
  <script src="ydn.db-isw-core-crypt-qry-dev.js"></script>
</head>
<body>
  <h3>Using crypto module</h3>
<script>
  var schema = {
    stores: [{
      name: 'store',
      keyPath: 'key'
    }]
  };
  var options = {
    method: 'rc4',
    exposeKey: true,
    secrets: [{
      name: 'aaaa',
      key: 'aYHF6vfuGHpfWS*eRLrPQxZjSó~É5c6HjCscqDqRtZasp¡JWSMGaW'
    }]
  };
  var cipher = new ydn.crypto.Cipher(options);
  var messages = [{
    msg: 'Test 1'
  }, {
    msg: 'Test 2'
  }];

  var db = new ydn.db.Storage('crypto-test', schema);

  db.put('store', messages.map(function(msg) {
    return cipher.encrypt(msg);
  })).done(function(keys) {
    console.log(keys);
    db.values('store', keys).done(function(packages) {
      return packages.map(function(obj) {
        return cipher.decrypt(obj);
      });
    }).done(function(objs) {
      console.log('query by keys', objs);
    })
  });

  db.values('store').done(function(packages) {
    return packages.map(function(obj) {
      console.log(obj);
      return cipher.decrypt(obj);
    });
  }).done(function(msgs) {
    console.log('all decrypted messages', msgs);
  });
</script>
<p>See source code and console.</p>
  <p><a href="http://dev.yathit.com/api/ydn/crypto/Cipher.html">API documentation</a></p>
  <p><a href="todo.html">Encrypted TODO app</a></p>
</body>
</html>